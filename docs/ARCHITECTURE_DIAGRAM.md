# ç³»ç»Ÿæ¶æ„å›¾ - AccountDoctor

---

## ğŸ—ï¸ ç³»ç»Ÿæ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        User Browser (å®¢æˆ·ç«¯)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚   è¾“å…¥é¡µé¢    â”‚â†’ â”‚ ProfileSnapshotâ”‚â†’ â”‚ StrategySectionâ”‚           â”‚
â”‚  â”‚  (page.tsx)  â”‚  â”‚  (Fast Lane)  â”‚  â”‚  (Slow Lane)   â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚         â”‚                 â†‘                    â†‘                     â”‚
â”‚         â”‚                 â”‚                    â”‚ SSE                 â”‚
â”‚         â”‚              æ¯«ç§’çº§                å¼‚æ­¥åŠ è½½                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                 â”‚                    â”‚
          â†“                 â”‚                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Next.js Backend (æœåŠ¡ç«¯)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  POST /api/audit/init           GET /api/audit/{id}/strategy        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  1. ç¼“å­˜æ£€æŸ¥       â”‚          â”‚  1. è·å–Fastç»“æœ     â”‚            â”‚
â”‚  â”‚  2. Apifyè°ƒç”¨      â”‚          â”‚  2. AI Prompt Set 2  â”‚            â”‚
â”‚  â”‚  3. AI Prompt Set 1â”‚          â”‚  3. SSEæµå¼æ¨é€      â”‚            â”‚
â”‚  â”‚  4. è¿”å›Snapshot   â”‚          â”‚  4. ä¿å­˜ç­–ç•¥         â”‚            â”‚
â”‚  â”‚  5. è§¦å‘åå°ä»»åŠ¡   â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚          â”‚                              â”‚                            â”‚
â”‚          â†“                              â†“                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚         Background Task Queue                â”‚                   â”‚
â”‚  â”‚  - AIç­–ç•¥ç”Ÿæˆ                                 â”‚                   â”‚
â”‚  â”‚  - 30å¤©æ—¥å†æ„å»º                               â”‚                   â”‚
â”‚  â”‚  - å›¾ç‰‡ç”Ÿæˆ (å¯é€‰)                            â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                  â”‚
               â†“                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Supabase Database   â”‚  â”‚   External Services   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                       â”‚  â”‚                       â”‚
â”‚  audits               â”‚  â”‚  Apify                â”‚
â”‚  â”œâ”€ id (PK)           â”‚  â”‚  â”œâ”€ Instagram Scraper â”‚
â”‚  â”œâ”€ username          â”‚  â”‚  â””â”€ Rate: $2.70/1000 â”‚
â”‚  â”œâ”€ apify_raw_data    â”‚  â”‚                       â”‚
â”‚  â”œâ”€ profile_snapshot  â”‚  â”‚  DeerAPI (Gemini)     â”‚
â”‚  â”œâ”€ strategy_section  â”‚  â”‚  â”œâ”€ Prompt Set 1      â”‚
â”‚  â”œâ”€ status            â”‚  â”‚  â”œâ”€ Prompt Set 2      â”‚
â”‚  â”œâ”€ expires_at (ç´¢å¼•) â”‚  â”‚  â””â”€ Rate: $0.01/1K    â”‚
â”‚  â””â”€ created_at        â”‚  â”‚                       â”‚
â”‚                       â”‚  â”‚  Sidewalk AI (é¢„ç•™)   â”‚
â”‚  generated_images     â”‚  â”‚  â””â”€ Image Gen         â”‚
â”‚  â””â”€ audit_id (FK)     â”‚  â”‚                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ æ•°æ®æµè¯¦è§£

### Flow 1: Fast Lane (é¦–æ¬¡è¯·æ±‚) - âœ… Serverlessä¼˜åŒ–ç‰ˆ

```
ç”¨æˆ·
 â”‚
 â”‚ POST /api/audit/init
 â”‚ { username: "zongzi_coffee" }
 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Route: /api/audit/init       â”‚
â”‚ (ä»…è´Ÿè´£Fast Laneæ•°æ®)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 â”‚
 â”œâ”€â†’ [1] æ£€æŸ¥Supabaseç¼“å­˜
 â”‚    SELECT * FROM audits
 â”‚    WHERE username = 'zongzi_coffee'
 â”‚    AND expires_at > NOW()
 â”‚
 â”œâ”€â†’ [2] Cache Miss
 â”‚
 â”œâ”€â†’ [3] è°ƒç”¨Apify
 â”‚    actor('apify/instagram-scraper').call({
 â”‚      directUrls: ["https://instagram.com/zongzi_coffee/"],
 â”‚      resultsType: 'details',
 â”‚      resultsLimit: 50
 â”‚    })
 â”‚    â†“
 â”‚   â±ï¸ ~3-5ç§’
 â”‚    â†“
 â”‚   è¿”å›åŸå§‹JSON
 â”‚
 â”œâ”€â†’ [4] AI Prompt Set 1 (Profile Analyst)
 â”‚    callGemini(rawData, PROFILE_ANALYST_SYSTEM_PROMPT)
 â”‚    â†“
 â”‚   â±ï¸ ~1-2ç§’
 â”‚    â†“
 â”‚   è¿”å› { profile_snapshot, diagnosis_card }
 â”‚
 â”œâ”€â†’ [5] ä¿å­˜åˆ°æ•°æ®åº“
 â”‚    INSERT INTO audits (
 â”‚      apify_raw_data,
 â”‚      profile_snapshot,
 â”‚      diagnosis_card,
 â”‚      status: 'snapshot_ready'  // âš ï¸ ä¸æ ‡è®°ä¸ºanalyzing
 â”‚    )
 â”‚
 â””â”€â†’ [6] ç«‹å³è¿”å›å“åº” (è¿›ç¨‹ç»“æŸ)
      {
        audit_id: "uuid-xxx",
        status: "snapshot_ready",
        profile_snapshot: { ... },
        diagnosis_card: { ... }
      }
      â†“
     â±ï¸ æ€»è€—æ—¶: ~4-7ç§’
      â†“
     å‰ç«¯ç«‹å³æ¸²æŸ“ âœ…
      â†“
     ğŸ”´ è¿›ç¨‹é”€æ¯ (Serverlessç¯å¢ƒ)
```

**ğŸš¨ å…³é”®ä¿®æ­£**: ä¸å†è§¦å‘åå°ä»»åŠ¡!Slow Laneæ”¹ä¸ºæ‡’åŠ è½½æ¨¡å¼ã€‚

---

### Flow 2: Slow Lane (æ‡’åŠ è½½æ¨¡å¼) - âœ… Serverlessä¼˜åŒ–ç‰ˆ

```
å‰ç«¯å»ºç«‹SSEè¿æ¥
 â”‚
 â”‚ GET /api/audit/{id}/strategy
 â”‚ Accept: text/event-stream
 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SSE Route (è¿æ¥ä¿æŒæ´»è·ƒ)             â”‚
â”‚ ğŸ”¥ è¿›ç¨‹ä¸ä¼šè¢«å†»ç»“!                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 â”‚
 â”œâ”€â†’ [1] æŸ¥è¯¢æ•°æ®åº“
 â”‚    SELECT * FROM audits WHERE id = ?
 â”‚
 â”œâ”€â†’ [2] æ£€æŸ¥æ˜¯å¦å·²æœ‰ç¼“å­˜ç­–ç•¥
 â”‚    IF strategy_section EXISTS:
 â”‚      â”œâ”€â†’ æƒ…å†µA: ç¼“å­˜å‘½ä¸­
 â”‚      â”‚   SSEæ¨é€: event complete (ç«‹å³è¿”å›)
 â”‚      â”‚   â±ï¸ ~50ms
 â”‚      â”‚   å…³é—­è¿æ¥ âœ…
 â”‚      â”‚
 â”‚      â””â”€â†’ æƒ…å†µB: æ— ç¼“å­˜ (é¦–æ¬¡ç”Ÿæˆ)
 â”‚           â†“ ç»§ç»­æ‰§è¡Œ...
 â”‚
 â”œâ”€â†’ [3] æ ‡è®°ä¸º"åˆ†æä¸­"
 â”‚    UPDATE audits SET status = 'analyzing', progress = 10
 â”‚    SSEæ¨é€: event status {"phase": "analyzing", "progress": 10}
 â”‚
 â”œâ”€â†’ [4] ğŸ”¥ AI Prompt Set 2 (åœ¨SSEè¿æ¥å†…æ‰§è¡Œ)
 â”‚    è¾“å…¥:
 â”‚    - category_label: "Coffee Shop"
 â”‚    - diagnosis_summary: "Great Foundation, Missed Opportunities"
 â”‚    - biography: "..."
 â”‚    â†“
 â”‚   â±ï¸ ~10-15ç§’ (è¿›ç¨‹ä¿æŒå­˜æ´»,å› ä¸ºSSEè¿æ¥æœªå…³é—­)
 â”‚    â†“
 â”‚   è¿”å› { strategy_section, execution_calendar }
 â”‚    â†“
 â”‚   SSEæ¨é€: event status {"phase": "generating_persona", "progress": 30}
 â”‚
 â”œâ”€â†’ [5] è§£æAIå“åº”
 â”‚    JSON.parse(aiResponse)
 â”‚    â†“
 â”‚   SSEæ¨é€: event status {"phase": "building_calendar", "progress": 60}
 â”‚
 â”œâ”€â†’ [6] ä¿å­˜åˆ°æ•°æ®åº“
 â”‚    UPDATE audits SET
 â”‚      strategy_section = { ... },
 â”‚      execution_calendar = { ... },
 â”‚      status = 'completed',
 â”‚      progress = 100
 â”‚
 â””â”€â†’ [7] SSEæ¨é€å®Œæˆäº‹ä»¶
      event: complete
      data: { strategy_section, execution_calendar }
      â†“
     å…³é—­SSEè¿æ¥
      â†“
     â±ï¸ æ€»è€—æ—¶: ~15-30ç§’ (ä½†è¿æ¥ä¿æŒæ´»è·ƒ!)
      â†“
     å‰ç«¯æ¸²æŸ“ç­–ç•¥+æ—¥å† âœ…
```

**ğŸš¨ å…³é”®å·®å¼‚**:
- âŒ æ—§æ–¹æ¡ˆ: Fast Laneè¿”å› â†’ è§¦å‘åå°ä»»åŠ¡ â†’ è¿›ç¨‹å†»ç»“ â†’ AIå¤±è´¥
- âœ… æ–°æ–¹æ¡ˆ: Fast Laneè¿”å› â†’ å‰ç«¯å»ºç«‹SSE â†’ AIåœ¨è¿æ¥å†…æ‰§è¡Œ â†’ æˆåŠŸ

---

### Flow 3: ç¼“å­˜å‘½ä¸­ (ç¬¬äºŒæ¬¡è¯·æ±‚)

```
ç”¨æˆ· (2å°æ—¶å)
 â”‚
 â”‚ POST /api/audit/init
 â”‚ { username: "zongzi_coffee" }
 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Route: /api/audit/init       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 â”‚
 â”œâ”€â†’ [1] æ£€æŸ¥Supabaseç¼“å­˜
 â”‚    SELECT * FROM audits
 â”‚    WHERE username = 'zongzi_coffee'
 â”‚    AND expires_at > NOW()
 â”‚    â†“
 â”‚   âœ… Cache Hit
 â”‚
 â”œâ”€â†’ [2] ç›´æ¥è¿”å›ç¼“å­˜æ•°æ®
 â”‚    {
 â”‚      audit_id: "uuid-xxx",
 â”‚      profile_snapshot: { ... },  // æ¥è‡ªç¼“å­˜
 â”‚      diagnosis_card: { ... },
 â”‚      cache_hit: true,
 â”‚      expires_at: "2025-01-29T10:00:00Z"
 â”‚    }
 â”‚
 â””â”€â†’ â±ï¸ æ€»è€—æ—¶: ~50-100ms (ä»…DBæŸ¥è¯¢)
      â†“
     å‰ç«¯ç¬é—´æ¸²æŸ“ âœ…
      â†“
     èŠ‚çœApifyæˆæœ¬ ğŸ’°
```

---

## ğŸ­ ç”¨æˆ·æ—…ç¨‹æ—¶é—´çº¿

### åœºæ™¯: é¦–æ¬¡è¯Šæ–­è´¦å·

```
æ—¶é—´è½´                  åç«¯æ“ä½œ                    å‰ç«¯å±•ç¤º                     ç”¨æˆ·å¿ƒç†
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
T+0s     â”‚  ç”¨æˆ·è¾“å…¥ @zongzi_coffee     â”‚  æ˜¾ç¤ºloadingçŠ¶æ€            â”‚ "è®©æˆ‘çœ‹çœ‹æˆ‘çš„è´¦å·æ€ä¹ˆæ ·"
         â”‚  ç‚¹å‡»"å¼€å§‹è¯Šæ–­"              â”‚                            â”‚
         â†“                               â†“                            â†“

T+0.5s   â”‚  POST /api/audit/init        â”‚  "åˆ†æä¸­..."               â”‚ (ç­‰å¾…)
         â”‚  â†’ æ£€æŸ¥ç¼“å­˜                   â”‚                            â”‚
         â”‚  â†’ Cache Miss                â”‚                            â”‚
         â†“                               â†“                            â†“

T+1s     â”‚  è°ƒç”¨Apify                   â”‚  è¿›åº¦: "è·å–æ•°æ® âœ“"         â”‚ "æœ‰ååº”äº†"
         â”‚  Scraperå¯åŠ¨                 â”‚        "AIåˆ†æ â³"          â”‚
         â†“                               â†“                            â†“

T+4s     â”‚  Apifyè¿”å›æ•°æ®               â”‚  è¿›åº¦: "AIåˆ†æ âœ“"          â”‚ "å¿«å¥½äº†"
         â”‚  â†’ AI Prompt Set 1           â”‚        "ç”ŸæˆæŠ¥å‘Š â³"        â”‚
         â†“                               â†“                            â†“

T+5s     â”‚  Fast Laneå®Œæˆ               â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•       â”‚ "å“‡!çœ‹åˆ°ç»“æœäº†!"
         â”‚  è¿”å› snapshot + diagnosis    â”‚  ã€Profile Snapshotã€‘      â”‚ âœ… å…³é”®æ—¶åˆ»
         â”‚                               â”‚  - å¤´åƒã€åç§°ã€ç²‰ä¸æ•°        â”‚
         â”‚                               â”‚  ã€Diagnosis Cardã€‘        â”‚ "åˆ†æ•°æ˜¯64?
         â”‚                               â”‚  - è¯„åˆ†: 64/100            â”‚  ä¸ºä»€ä¹ˆè¿™ä¹ˆä½?"
         â”‚  â†“ (éé˜»å¡)                   â”‚  - 3ä¸ªå…³é”®é—®é¢˜             â”‚
         â”‚  è§¦å‘Slow Laneåå°ä»»åŠ¡        â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•       â”‚
         â†“                               â†“                            â†“

T+6s     â”‚  (åå°) AIç”Ÿæˆç­–ç•¥ä¸­...       â”‚  ã€ä¸‹æ–¹æ˜¾ç¤ºã€‘              â”‚ (å¼€å§‹é˜…è¯»é—®é¢˜)
         â”‚  â†’ Prompt Set 2               â”‚  "AIæ­£åœ¨ä¸ºä½ å®šåˆ¶ç­–ç•¥..."    â”‚ "å“¦,åŸå› æ˜¯è¿™äº›å•Š"
         â”‚                               â”‚  è¿›åº¦æ¡: 10%               â”‚
         â†“                               â†“                            â†“

T+15s    â”‚  (åå°) ç­–ç•¥ç”Ÿæˆå®Œæˆ          â”‚  è¿›åº¦æ¡: 60%               â”‚ (ç»§ç»­ç­‰å¾…)
         â”‚  â†’ ç”Ÿæˆ30å¤©æ—¥å†               â”‚  "æ­£åœ¨è§„åˆ’30å¤©å†…å®¹..."      â”‚ "30å¤©å†…å®¹?æœ‰ç‚¹æ„æ€"
         â†“                               â†“                            â†“

T+25s    â”‚  (åå°) å…¨éƒ¨å®Œæˆ              â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•       â”‚ "è¿™ç­–ç•¥çœ‹èµ·æ¥å¾ˆä¸“ä¸š!"
         â”‚  SSE: event complete          â”‚  ã€Strategy Sectionã€‘      â”‚
         â”‚                               â”‚  - å“ç‰Œäººè®¾                 â”‚ "é¥¼å›¾å¾ˆç›´è§‚"
         â”‚                               â”‚  - å†…å®¹é…æ¯”é¥¼å›¾             â”‚
         â”‚                               â”‚  ã€30-Day Calendarã€‘       â”‚ "Day 1çš„æ–‡æ¡ˆå†™å¾—çœŸå¥½"
         â”‚                               â”‚  - Day 1å®Œæ•´å†…å®¹           â”‚
         â”‚                               â”‚  - Day 2-30é”å®š ğŸ”’         â”‚ "æƒ³çœ‹å‰©ä¸‹29å¤©çš„..."
         â”‚                               â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•       â”‚
         â”‚                               â”‚  ã€CTAæŒ‰é’®ã€‘               â”‚ â†“
         â”‚                               â”‚  "è§£é”å®Œæ•´30å¤©è®¡åˆ’"         â”‚ ç‚¹å‡»æ³¨å†Œ ğŸ’°
         â””                               â””                            â””
```

**å…³é”®æ´å¯Ÿ**:
- âœ… T+5s æ—¶ç”¨æˆ·å·²ç»æœ‰ä¸œè¥¿å¯çœ‹ (ä¸æ˜¯ç™½å±)
- âœ… T+25s æ—¶ç”¨æˆ·çœ‹åˆ°å®Œæ•´ç­–ç•¥ (æ€»ç­‰å¾…æ—¶é—´å¯æ¥å—)
- âœ… æ„ŸçŸ¥é€Ÿåº¦ = Fast Laneå“åº” = **5ç§’** (è€Œéå®é™…çš„25ç§’)

---

## ğŸ”€ è¯·æ±‚è·¯ç”±å›¾

```
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚  ç”¨æˆ·è¾“å…¥è´¦å·     â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  POST /api/audit/init          â”‚
                    â”‚  (Fast Lane Entry Point)       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚                     â”‚
                  â†“                     â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  ç¼“å­˜å‘½ä¸­ (24h)  â”‚    â”‚   ç¼“å­˜æœªå‘½ä¸­     â”‚
         â”‚  Cache Hit       â”‚    â”‚   Cache Miss     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                       â”‚
                  â”‚                       â†“
                  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚              â”‚  è°ƒç”¨Apify       â”‚
                  â”‚              â”‚  Scraper         â”‚
                  â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                       â”‚
                  â”‚                       â†“
                  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚              â”‚  AI Prompt Set 1 â”‚
                  â”‚              â”‚  (Profile        â”‚
                  â”‚              â”‚   Analyst)       â”‚
                  â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                       â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  è¿”å› Fast Lane       â”‚
                    â”‚  - profile_snapshot   â”‚
                    â”‚  - diagnosis_card     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”œâ”€â”€â†’ å‰ç«¯ç«‹å³æ¸²æŸ“ âœ…
                               â”‚
                               â””â”€â”€â†’ è§¦å‘åå°ä»»åŠ¡
                                    (éé˜»å¡)
                                         â”‚
                                         â†“
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚  Background Task:        â”‚
                            â”‚  Slow Lane Processing    â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â†“
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚  AI Prompt Set 2         â”‚
                            â”‚  (Strategic Director)    â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â†“
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚  ä¿å­˜ç­–ç•¥åˆ°DB            â”‚
                            â”‚  UPDATE audits SET       â”‚
                            â”‚  strategy_section = ...  â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â†“
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚  SSEæ¨é€å®Œæˆäº‹ä»¶         â”‚
                            â”‚  event: complete         â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â†“
                                 å‰ç«¯æ¸²æŸ“ç­–ç•¥ âœ…
```

---

## ğŸ—„ï¸ æ•°æ®åº“ERå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         audits                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK  id                    UUID                           â”‚
â”‚     username              VARCHAR(255)      [indexed]    â”‚
â”‚     status                VARCHAR(50)       [indexed]    â”‚
â”‚     progress              INTEGER (0-100)                â”‚
â”‚     created_at            TIMESTAMPTZ       [indexed]    â”‚
â”‚     updated_at            TIMESTAMPTZ                    â”‚
â”‚     expires_at            TIMESTAMPTZ       [indexed]    â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€ Fast Lane Data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  apify_raw_data        JSONB              â”‚           â”‚
â”‚  â”‚  profile_snapshot      JSONB              â”‚           â”‚
â”‚  â”‚  diagnosis_card        JSONB              â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€ Slow Lane Data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  strategy_section      JSONB              â”‚           â”‚
â”‚  â”‚  execution_calendar    JSONB              â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€ Metadata â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  apify_run_id          VARCHAR(255)       â”‚           â”‚
â”‚  â”‚  ai_model_used         VARCHAR(100)       â”‚           â”‚
â”‚  â”‚  generation_time_ms    INTEGER            â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€ Error Handling â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  error_code            VARCHAR(100)       â”‚           â”‚
â”‚  â”‚  error_message         TEXT               â”‚           â”‚
â”‚  â”‚  retry_count           INTEGER            â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                           â”‚
â”‚ FK  user_id               UUID â†’ users.id    [nullable]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ 1:N
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    generated_images                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK  id                    UUID                           â”‚
â”‚ FK  audit_id              UUID â†’ audits.id               â”‚
â”‚     day_number            INTEGER (1-30)                 â”‚
â”‚     prompt                TEXT                           â”‚
â”‚     image_url             TEXT                           â”‚
â”‚     thumbnail_url         TEXT                           â”‚
â”‚     status                VARCHAR(50)                    â”‚
â”‚     created_at            TIMESTAMPTZ                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” å®‰å…¨æ¶æ„

### å¤šå±‚é˜²æŠ¤

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Security Layers                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤

â”‚  Layer 1: Input Validation                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ - Usernameæ ¼å¼éªŒè¯ (æ­£åˆ™)                    â”‚        â”‚
â”‚  â”‚ - SQLæ³¨å…¥é˜²æŠ¤ (å‚æ•°åŒ–æŸ¥è¯¢)                   â”‚        â”‚
â”‚  â”‚ - XSSé˜²æŠ¤ (Content-Typeæ£€æŸ¥)                â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                      â†“                                    â”‚

â”‚  Layer 2: Rate Limiting                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ - IPé™æµ: 1æ¬¡/å°æ—¶, 3æ¬¡/å¤©                   â”‚        â”‚
â”‚  â”‚ - ç”¨æˆ·é™æµ: 10æ¬¡/å¤© (è®¤è¯ç”¨æˆ·)               â”‚        â”‚
â”‚  â”‚ - å…¨å±€é™æµ: 100æ¬¡/å°æ—¶                       â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                      â†“                                    â”‚

â”‚  Layer 3: API Key Protection                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ - ç¯å¢ƒå˜é‡åŠ å¯†å­˜å‚¨                           â”‚        â”‚
â”‚  â”‚ - Apify Tokenåªåœ¨æœåŠ¡ç«¯ä½¿ç”¨                  â”‚        â”‚
â”‚  â”‚ - å‰ç«¯æ°¸ä¸æš´éœ²å¯†é’¥                           â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                      â†“                                    â”‚

â”‚  Layer 4: Data Privacy                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ - åªçˆ¬å–å…¬å¼€æ•°æ®                             â”‚        â”‚
â”‚  â”‚ - 24å°æ—¶åè‡ªåŠ¨æ¸…ç†                           â”‚        â”‚
â”‚  â”‚ - ç”¨æˆ·å¯è¯·æ±‚åˆ é™¤æ•°æ®                         â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¡ SSE vs Polling å¯¹æ¯”

### ä¸ºä»€ä¹ˆé€‰æ‹©SSE?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SSE (Server-Sent Events)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  ä¼˜ç‚¹:                                                   â”‚
â”‚  âœ… å•å‘æ¨é€,é€‚åˆè¿›åº¦æ›´æ–°                                â”‚
â”‚  âœ… è‡ªåŠ¨é‡è¿æœºåˆ¶                                         â”‚
â”‚  âœ… HTTPåè®®,æ— éœ€é¢å¤–é…ç½®                                â”‚
â”‚  âœ… æ€§èƒ½ä¼˜äºè½®è¯¢                                         â”‚
â”‚                                                          â”‚
â”‚  ç¼ºç‚¹:                                                   â”‚
â”‚  âŒ ä¸æ”¯æŒåŒå‘é€šä¿¡ (ä½†æˆ‘ä»¬ä¸éœ€è¦)                        â”‚
â”‚  âŒ éƒ¨åˆ†è€æµè§ˆå™¨ä¸æ”¯æŒ (å¯é™çº§åˆ°Polling)                 â”‚
â”‚                                                          â”‚
â”‚  å®ç°æˆæœ¬: â­â­ (ä½)                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Polling (è½®è¯¢)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  ä¼˜ç‚¹:                                                   â”‚
â”‚  âœ… å…¼å®¹æ€§100%                                           â”‚
â”‚  âœ… å®ç°ç®€å•                                             â”‚
â”‚                                                          â”‚
â”‚  ç¼ºç‚¹:                                                   â”‚
â”‚  âŒ æµªè´¹å¸¦å®½ (æ¯2ç§’å‘ä¸€æ¬¡è¯·æ±‚)                           â”‚
â”‚  âŒ å»¶è¿Ÿé«˜ (æœ€åæƒ…å†µ2ç§’)                                 â”‚
â”‚  âŒ æœåŠ¡å™¨è´Ÿè½½é«˜                                         â”‚
â”‚                                                          â”‚
â”‚  å®ç°æˆæœ¬: â­ (æä½)                                     â”‚
â”‚  ç”¨é€”: SSEçš„é™çº§æ–¹æ¡ˆ                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WebSocket                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  ä¼˜ç‚¹:                                                   â”‚
â”‚  âœ… åŒå‘é€šä¿¡                                             â”‚
â”‚  âœ… ä½å»¶è¿Ÿ                                               â”‚
â”‚                                                          â”‚
â”‚  ç¼ºç‚¹:                                                   â”‚
â”‚  âŒ è¿‡åº¦è®¾è®¡ (æˆ‘ä»¬åªéœ€è¦å•å‘æ¨é€)                        â”‚
â”‚  âŒ éœ€è¦é¢å¤–é…ç½® (Vercelä¸æ”¯æŒ)                          â”‚
â”‚  âŒ å®ç°æˆæœ¬é«˜                                           â”‚
â”‚                                                          â”‚
â”‚  å®ç°æˆæœ¬: â­â­â­â­ (é«˜)                                 â”‚
â”‚  å†³ç­–: âŒ ä¸é‡‡ç”¨                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æœ€ç»ˆå†³ç­–**: SSEä¸»æ–¹æ¡ˆ + Pollingé™çº§

---

## ğŸ’¾ ç¼“å­˜æ¶æ„è¯¦è§£

### ä¸‰çº§ç¼“å­˜ç­–ç•¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Level 1: Browser Cache (å‰ç«¯)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  - localStorageç¼“å­˜audit_id                               â”‚
â”‚  - ç”¨æˆ·åˆ·æ–°é¡µé¢æ—¶ç›´æ¥ä»ç¼“å­˜è¯»å–                            â”‚
â”‚  - TTL: ä¼šè¯çº§åˆ«                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Level 2: Database Cache (Supabase)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  - å­˜å‚¨å®Œæ•´çš„auditè®°å½•                                     â”‚
â”‚  - ç´¢å¼•: username + expires_at                            â”‚
â”‚  - TTL: 24å°æ—¶                                            â”‚
â”‚  - å‘½ä¸­ç‡: ~75%                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Level 3: Apify API (External)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  - ä»…åœ¨ç¼“å­˜æœªå‘½ä¸­æ—¶è°ƒç”¨                                    â”‚
â”‚  - æˆæœ¬: $0.0027/æ¬¡                                       â”‚
â”‚  - è°ƒç”¨é¢‘ç‡: é¢„è®¡ 25%çš„è¯·æ±‚                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç¼“å­˜å†³ç­–æ ‘

```
ç”¨æˆ·è¯·æ±‚ @username
     â”‚
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ£€æŸ¥ Level 1    â”‚  â† localStorage
â”‚ (Browser)       â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€ Hit? â†’ è¿”å› (0ms)
     â”‚
     â†“ Miss
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ£€æŸ¥ Level 2    â”‚  â† Supabase DB
â”‚ (Database)      â”‚    WHERE username = ?
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    AND expires_at > NOW()
     â”‚
     â”œâ”€ Hit? â†’ è¿”å› (50-100ms)
     â”‚
     â†“ Miss
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è°ƒç”¨ Level 3    â”‚  â† Apify API
â”‚ (External API)  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â†“
   è¿”å› + å†™å…¥ç¼“å­˜ (3-5ç§’)
```

---

## ğŸ¯ æ€§èƒ½ä¼˜åŒ–ç‚¹

### Critical Rendering Pathä¼˜åŒ–

```
1. é¦–å±å…³é”®CSSå†…è”
   <style dangerouslySetInnerHTML={{__html: criticalCSS}} />

2. å›¾ç‰‡æ‡’åŠ è½½
   <img loading="lazy" src={...} />

3. ä»£ç åˆ†å‰²
   const Calendar = dynamic(() => import('./Calendar'), {
     loading: () => <CalendarSkeleton />
   })

4. é¢„è¿æ¥å¤–éƒ¨åŸŸå
   <link rel="preconnect" href="https://api.apify.com" />
   <link rel="dns-prefetch" href="https://api.deerapi.com" />

5. èµ„æºä¼˜å…ˆçº§
   <link rel="preload" href="/fonts/merriweather.woff2" as="font" />
```

### Bundle Sizeä¼˜åŒ–

```typescript
// ä½¿ç”¨tree-shakingå‹å¥½çš„å¯¼å…¥
import { format } from 'date-fns/format'  // âœ… åªå¯¼å…¥éœ€è¦çš„å‡½æ•°
// è€Œä¸æ˜¯
import * as dateFns from 'date-fns'      // âŒ å¯¼å…¥æ•´ä¸ªåº“

// åŠ¨æ€å¯¼å…¥é‡å‹ç»„ä»¶
const Chart = dynamic(() => import('recharts').then(mod => mod.PieChart), {
  ssr: false
})
```

---

## ğŸ§© æ¨¡å—ä¾èµ–å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    App Layer                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ page.tsx â”‚â†’ â”‚result/   â”‚â†’ â”‚componentsâ”‚             â”‚
â”‚  â”‚          â”‚  â”‚page.tsx  â”‚  â”‚          â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   API Layer                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ /api/audit/  â”‚â†’ â”‚ /api/internalâ”‚                    â”‚
â”‚  â”‚ init         â”‚  â”‚ /apify       â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Service Layer                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚lib/scrapers â”‚ â”‚ lib/ai      â”‚ â”‚ lib/cache   â”‚      â”‚
â”‚  â”‚- apify.ts   â”‚ â”‚- gemini.ts  â”‚ â”‚- cache.ts   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Data Layer                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚ Supabase    â”‚ â”‚ Prisma      â”‚                       â”‚
â”‚  â”‚ (Primary)   â”‚ â”‚ (Fallback)  â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¬ æ‰§è¡Œæµç¨‹æ€»ç»“

### å…³é”®æ—¶é—´èŠ‚ç‚¹

| æ—¶é—´ç‚¹ | åç«¯æ“ä½œ | å‰ç«¯æ¸²æŸ“ | ç”¨æˆ·æ„ŸçŸ¥ |
|-------|---------|---------|---------|
| **T+0s** | æ¥æ”¶è¯·æ±‚ | Loading... | "ç­‰å¾…ä¸­" |
| **T+0.1s** | ç¼“å­˜æ£€æŸ¥ | - | - |
| **T+3s** | Apifyè¿”å› | - | (çœ‹åˆ°è¿›åº¦æ¡æ›´æ–°) |
| **T+5s** | Fast Laneå®Œæˆ | âœ… ProfileSnapshot<br>âœ… DiagnosisCard | "æœ‰ç»“æœäº†!" |
| **T+6s** | Slow Laneå¯åŠ¨ | AI Thinking... | (å¼€å§‹é˜…è¯»åˆ†æ•°) |
| **T+15s** | AIç”Ÿæˆäººè®¾ | è¿›åº¦60% | (ç»§ç»­ç­‰å¾…) |
| **T+25s** | Slow Laneå®Œæˆ | âœ… Strategy<br>âœ… Calendar | "ç­–ç•¥å¾ˆä¸“ä¸š!" |

**æ ¸å¿ƒæŒ‡æ ‡**:
- **é¦–æ¬¡å†…å®¹æ¸²æŸ“ (FCP)**: 5ç§’
- **å®Œå…¨åŠ è½½ (TTI)**: 25ç§’
- **ç”¨æˆ·æ„ŸçŸ¥é€Ÿåº¦**: 5ç§’ (å› ä¸ºæœ‰å†…å®¹å¯çœ‹)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2025-01-28
